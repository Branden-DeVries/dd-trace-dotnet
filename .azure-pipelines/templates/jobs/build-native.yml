job: native_windows
strategy:
  matrix:
    x64:
      buildPlatform: x64
    x86:
      buildPlatform: x86

pool:
  vmImage: windows-2019

steps:
- task: UseDotNet@2
  displayName: install dotnet core sdk 3.1
  inputs:
    packageType: sdk
    version: 3.1.x

- task: DotNetCoreCLI@2
  displayName: dotnet build
  inputs:
    command: build
    configuration: $(buildConfiguration)
    projects: |
      src/Datadog.Trace.ClrProfiler.Managed.Loader/Datadog.Trace.ClrProfiler.Managed.Loader.csproj

- task: NuGetCommand@2
  displayName: nuget restore
  inputs:
    restoreSolution: Datadog.Trace.Native.sln
    vstsFeed: $(packageFeed)
    verbosityRestore: Normal

- task: MSBuild@1
  displayName: msbuild
  inputs:
    solution: Datadog.Trace.proj
    platform: $(buildPlatform)
    configuration: $(buildConfiguration)
    msbuildArguments: /t:BuildCpp
    maximumCpuCount: true
